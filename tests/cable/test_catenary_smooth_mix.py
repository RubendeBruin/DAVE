"""The solution of the elastic catenary equation is solved numerically and
involves some fits. This test compares the results of the catenary solver to see if the produced
output is smooth and continuous."""

import numpy as np
from numpy.testing import assert_allclose

from DAVE import *

def test_catenary_solution_smoothness():
# if __name__ == '__main__':

    s = Scene()
    f = s.new_frame('frame')
    s.new_point('p1', position=(0, 0, 0), parent=f)
    p2 = s.new_point('p2', position=(0, 0, 1), parent=f)

    c = s.new_cable(connections = ['p1', 'p2'], name='cable', EA = 100000, mass = 0.1, length=7)

    xs = np.linspace(6.9,6.95,1000)

    fx = []
    fz = []

    for x in xs:
        p2.x = x
        s.update()

        fx.append(-p2.fx)
        fz.append(-p2.fz)


    expected = [3.0761053,
3.0788365,
3.0815748,
3.0843203,
3.0870731,
3.0898330,
3.0926003,
3.0953748,
3.0981567,
3.1009460,
3.1037427,
3.1065468,
3.1093584,
3.1121775,
3.1150041,
3.1178383,
3.1206801,
3.1235295,
3.1263867,
3.1292515,
3.1321240,
3.1350044,
3.1378925,
3.1407885,
3.1436924,
3.1466042,
3.1495240,
3.1524517,
3.1553875,
3.1583313,
3.1612833,
3.1642434,
3.1672116,
3.1701881,
3.1731728,
3.1761658,
3.1791671,
3.1821768,
3.1851949,
3.1882215,
3.1912565,
3.1943001,
3.1973522,
3.2004129,
3.2034822,
3.2065603,
3.2096471,
3.2127426,
3.2158469,
3.2189601,
3.2220822,
3.2252132,
3.2283532,
3.2315022,
3.2346602,
3.2378274,
3.2410037,
3.2441892,
3.2473840,
3.2505880,
3.2538013,
3.2570241,
3.2602562,
3.2634978,
3.2667489,
3.2700096,
3.2732798,
3.2765597,
3.2798493,
3.2831487,
3.2864578,
3.2897768,
3.2931057,
3.2964445,
3.2997933,
3.3031521,
3.3065210,
3.3099000,
3.3132893,
3.3166888,
3.3200985,
3.3235186,
3.3269491,
3.3303900,
3.3338415,
3.3373035,
3.3407761,
3.3442593,
3.3477533,
3.3512580,
3.3547736,
3.3583000,
3.3618374,
3.3653857,
3.3689452,
3.3725157,
3.3760973,
3.3796902,
3.3832944,
3.3869099,
3.3905368,
3.3942473,
3.3978987,
3.4015616,
3.4052362,
3.4089225,
3.4126206,
3.4163306,
3.4200525,
3.4237863,
3.4275323,
3.4312903,
3.4350605,
3.4388429,
3.4426377,
3.4464448,
3.4502643,
3.4540964,
3.4579411,
3.4617984,
3.4656684,
3.4695512,
3.4734468,
3.4773554,
3.4812770,
3.4852117,
3.4891595,
3.4931205,
3.4970948,
3.5010824,
3.5050835,
3.5090982,
3.5131264,
3.5171683,
3.5212239,
3.5252933,
3.5293767,
3.5334740,
3.5375854,
3.5417109,
3.5458507,
3.5500047,
3.5541732,
3.5583561,
3.5625536,
3.5667657,
3.5709925,
3.5752341,
3.5794906,
3.5837621,
3.5880487,
3.5923504,
3.5966674,
3.6009997,
3.6053475,
3.6097107,
3.6140896,
3.6184842,
3.6228946,
3.6273208,
3.6317631,
3.6362214,
3.6406960,
3.6451868,
3.6496940,
3.6542176,
3.6587578,
3.6633148,
3.6678885,
3.6724790,
3.6770866,
3.6817113,
3.6863531,
3.6910123,
3.6956889,
3.7003830,
3.7050947,
3.7098241,
3.7145715,
3.7193367,
3.7241201,
3.7289216,
3.7337415,
3.7385798,
3.7434366,
3.7483120,
3.7532063,
3.7581194,
3.7630516,
3.7680029,
3.7729735,
3.7779634,
3.7829729,
3.7880020,
3.7930509,
3.7981197,
3.8032085,
3.8083175,
3.8134467,
3.8185965,
3.8237667,
3.8289577,
3.8341695,
3.8394023,
3.8446562,
3.8499314,
3.8552280,
3.8605461,
3.8658859,
3.8712476,
3.8766312,
3.8820370,
3.8874651,
3.8929156,
3.8983887,
3.9038846,
3.9094034,
3.9149453,
3.9205104,
3.9260989,
3.9317110,
3.9373467,
3.9430064,
3.9486901,
3.9543981,
3.9601304,
3.9658874,
3.9716691,
3.9774757,
3.9833074,
3.9891644,
3.9950468,
4.0009549,
4.0068889,
4.0128489,
4.0188351,
4.0248477,
4.0308869,
4.0369529,
4.0430459,
4.0491660,
4.0553136,
4.0614888,
4.0676918,
4.0739228,
4.0801820,
4.0864697,
4.0927860,
4.0991312,
4.1055054,
4.1119090,
4.1183421,
4.1248050,
4.1312978,
4.1378209,
4.1443744,
4.1509587,
4.1575738,
4.1642201,
4.1708978,
4.1776072,
4.1843485,
4.1911220,
4.1979279,
4.2047664,
4.2116379,
4.2185426,
4.2254807,
4.2324526,
4.2394585,
4.2464987,
4.2535734,
4.2606830,
4.2678277,
4.2750078,
4.2822236,
4.2894754,
4.2967635,
4.3040882,
4.3114499,
4.3188487,
4.3262851,
4.3337593,
4.3412717,
4.3488225,
4.3564122,
4.3640410,
4.3717093,
4.3794174,
4.3871657,
4.3949545,
4.4027841,
4.4106550,
4.4185674,
4.4265218,
4.4345184,
4.4425578,
4.4506402,
4.4587661,
4.4669358,
4.4751497,
4.4834082,
4.4917117,
4.5000607,
4.5084555,
4.5168966,
4.5253843,
4.5339191,
4.5425015,
4.5511319,
4.5598107,
4.5685383,
4.5773153,
4.5861420,
4.5950190,
4.6039468,
4.6129257,
4.6219564,
4.6310392,
4.6401748,
4.6493635,
4.6586059,
4.6679026,
4.6772540,
4.6866607,
4.6961232,
4.7056421,
4.7152179,
4.7248513,
4.7345426,
4.7442927,
4.7541019,
4.7639710,
4.7739005,
4.7838911,
4.7939433,
4.8040578,
4.8142352,
4.8244762,
4.8347815,
4.8451516,
4.8555873,
4.8660892,
4.8766581,
4.8872947,
4.8979996,
4.9087736,
4.9196174,
4.9305319,
4.9415176,
4.9525754,
4.9637062,
4.9749106,
4.9861894,
4.9975436,
5.0089739,
5.0204812,
5.0320662,
5.0437300,
5.0554733,
5.0672971,
5.0792022,
5.0911896,
5.1032602,
5.1154150,
5.1276550,
5.1399810,
5.1523942,
5.1648954,
5.1774859,
5.1901665,
5.2029384,
5.2158026,
5.2287602,
5.2418124,
5.2549603,
5.2682049,
5.2815476,
5.2949895,
5.3085317,
5.3221755,
5.3359223,
5.3497731,
5.3637294,
5.3777924,
5.3919635,
5.4062440,
5.4206354,
5.4354323,
5.4500628,
5.4648091,
5.4796726,
5.4946548,
5.5097574,
5.5249819,
5.5403299,
5.5558031,
5.5714032,
5.5871319,
5.6029909,
5.6189820,
5.6351070,
5.6513678,
5.6677662,
5.6843042,
5.7009837,
5.7178067,
5.7347752,
5.7518913,
5.7691572,
5.7865749,
5.8041467,
5.8218748,
5.8397614,
5.8578090,
5.8760199,
5.8943964,
5.9129412,
5.9316567,
5.9505455,
5.9696102,
5.9888536,
6.0082783,
6.0278871,
6.0476830,
6.0676688,
6.0878476,
6.1082224,
6.1287963,
6.1495724,
6.1705541,
6.1917447,
6.2131476,
6.2347662,
6.2566041,
6.2786650,
6.3009526,
6.3234706,
6.3462230,
6.3692138,
6.3924470,
6.4159268,
6.4396575,
6.4636435,
6.4878891,
6.5123991,
6.5371782,
6.5622310,
6.5875626,
6.6131780,
6.6390824,
6.6652810,
6.6917794,
6.7185831,
6.7456978,
6.7731294,
6.8008838,
6.8289674,
6.8573863,
6.8861471,
6.9152564,
6.9447212,
6.9745484,
7.0047452,
7.0353191,
7.0662777,
7.0976288,
7.1293804,
7.1615408,
7.1941185,
7.2271222,
7.2605610,
7.2944439,
7.3287806,
7.3635808,
7.3988546,
7.4346123,
7.4708646,
7.5076225,
7.5448972,
7.5827003,
7.6210440,
7.6599405,
7.6994026,
7.7394434,
7.7800764,
7.8213156,
7.8631753,
7.9056705,
7.9488164,
7.9926288,
8.0371241,
8.0823191,
8.1282311,
8.1748783,
8.2222790,
8.2704524,
8.3194185,
8.3691976,
8.4198108,
8.4712802,
8.5236283,
8.5768784,
8.6310549,
8.6861827,
8.7422878,
8.7993970,
8.8575380,
8.9167397,
8.9782438,
9.0397754,
9.1024717,
9.1663670,
9.2314967,
9.2978978,
9.3656085,
9.4346686,
9.5051195,
9.5770042,
9.6503672,
9.7252551,
9.8017161,
9.8798005,
9.9595604,
10.0410502,
10.1243265,
10.2094482,
10.2964765,
10.3854752,
10.4765107,
10.5696522,
10.6649716,
10.7625440,
10.8624474,
10.9647631,
11.0695758,
11.1769736,
11.2870484,
11.3998957,
11.5156150,
11.6343098,
11.7560878,
11.8810611,
12.0093461,
12.1410638,
12.2763402,
12.4153057,
12.5580958,
12.7048511,
12.8557171,
13.0108446,
13.1703894,
13.3345126,
13.5033803,
13.6771636,
13.8560389,
14.0401870,
14.2297935,
14.4250483,
14.6261453,
14.8332821,
15.0466594,
15.2664804,
15.4929505,
15.7262763,
15.9666648,
16.2143228,
16.4694554,
16.7322655,
17.0029523,
17.2817102,
17.5687275,
17.8641848,
18.1682541,
18.4810968,
18.8088674,
19.1402351,
19.4808028,
19.8306724,
20.1899276,
20.5586333,
20.9368345,
21.3245555,
21.7217994,
22.1285481,
22.5447617,
22.9703791,
23.4053183,
23.8494770,
24.3027338,
24.7649486,
25.2359646,
25.7156090,
26.2036953,
26.7000242,
27.2043855,
27.7165600,
28.2363207,
28.7634350,
29.2976657,
29.8387730,
30.3865157,
30.9406525,
31.5009431,
32.0671494,
32.6390368,
33.2163742,
33.7989356,
34.3865001,
34.9788527,
35.5757847,
36.1770939,
36.7825848,
37.3920689,
38.0053647,
38.6222979,
39.2427009,
39.8664134,
40.4932818,
41.1231593,
41.7559055,
42.3913867,
43.0294752,
43.6700493,
44.3129932,
44.9581966,
45.6055546,
46.2549674,
46.9063401,
47.5595826,
48.2146090,
48.8713381,
49.5296923,
50.1895983,
50.8509862,
51.5137896,
52.1779457,
52.8430533,
53.5097822,
54.1776873,
54.8467181,
55.5168262,
56.1879658,
56.8600932,
57.5331671,
58.2071477,
58.8819977,
59.5576810,
60.2341637,
60.9114132,
61.5893987,
62.2680906,
62.9474608,
63.6274826,
64.3081303,
64.9893797,
65.6712074,
66.3535913,
67.0365101,
67.7199437,
68.4038727,
69.0882787,
69.7731440,
70.4584518,
71.1441859,
71.8303309,
72.5168721,
73.2037953,
73.8910871,
74.5787344,
75.2667249,
75.9550468,
76.6436886,
77.3326394,
78.0218888,
78.7114267,
79.4012436,
80.0913302,
80.7816776,
81.4722773,
82.1631211,
82.8542012,
83.5455101,
84.2370405,
84.9287854,
85.6207381,
86.3128922,
87.0052415,
87.6977800,
88.3905019,
89.0834017,
89.7764741,
90.4697139,
91.1631162,
91.8566763,
92.5503895,
93.2442514,
93.9382577,
94.6324042,
95.3266871,
96.0211025,
96.7156466,
97.4103159,
98.1051069,
98.8000163,
99.4950409,
100.1901774,
100.8854230,
101.5807746,
102.2762296,
102.9717850,
103.6674384,
104.3631871,
105.0590288,
105.7549608,
106.4509811,
107.1470873,
107.8432772,
108.5395488,
109.2359000,
109.9323288,
110.6288334,
111.3254118,
112.0220622,
112.7187830,
113.4155724,
114.1124287,
114.8093504,
115.5063360,
116.2033839,
116.9004926,
117.5976608,
118.2948871,
118.9921701,
119.6895086,
120.3869012,
121.0843468,
121.7818442,
122.4793922,
123.1769896,
123.8746355,
124.5723286,
125.2700681,
125.9678528,
126.6656818,
127.3635542,
128.0614690,
128.7594253,
129.4574223,
130.1554590,
130.8535347,
131.5516485,
132.2497997,
132.9479874,
133.6462110,
134.3444696,
135.0427627,
135.7410894,
136.4394491,
137.1378412,
137.8362650,
138.5347199,
139.2332052,
139.9317204,
140.6302649,
141.3288381,
142.0274395,
142.7260685,
143.4247246,
144.1234073,
144.8221161,
145.5208504,
146.2196099,
146.9183940,
147.6172023,
148.3160343,
149.0148897,
149.7137679,
150.4126685,
151.1115912,
151.8105356,
152.5095012,
153.2084877,
153.9074948,
154.6065220,
155.3055690,
156.0046354,
156.7037209,
157.4028253,
158.1019480,
158.8010890,
159.5002477,
160.1994240,
160.8986175,
161.5978279,
162.2970550,
162.9962984,
163.6955579,
164.3948333,
165.0941243,
165.7934305,
166.4922266,
167.1915680,
167.8909240,
168.5902944,
169.2896790,
169.9890775,
170.6884897,
171.3879154,
172.0873543,
172.7868063,
173.4862712,
174.1857487,
174.8852387,
175.5847409,
176.2842552,
176.9837814,
177.6833192,
178.3828686,
179.0824293,
179.7820012,
180.4815841,
181.1811778,
181.8807822,
182.5803971,
183.2800223,
183.9796577,
184.6793032,
185.3789586,
186.0786237,
186.7782984,
187.4779826,
188.1776761,
188.8773787,
189.5770905,
190.2768112,
190.9765406,
191.6762788,
192.3760255,
193.0757806,
193.7755441,
194.4753157,
195.1750954,
195.8748831,
196.5746786,
197.2744819,
197.9742928,
198.6741113,
199.3739371,
200.0737703,
200.7736108,
201.4734584,
202.1733130,
202.8731745,
203.5730430,
204.2729181,
204.9728000,
205.6726884,
206.3725833,
207.0724846,
207.7723923,
208.4723062,
209.1722263,
209.8721525,
210.5720846,
211.2720227,
211.9719667,
212.6719164,
213.3718719,
214.0718330,
214.7717996,
215.4717718,
216.1717494,
216.8717324,
217.5717206,
218.2717141,
218.9717128,
219.6717166,
220.3717254,
221.0717392,
221.7717580,
222.4717816,
223.1718100,
223.8718432,
224.5718811,
225.2719236,
225.9719707,
226.6720224,
227.3720785,
228.0721391,
228.7722041,
229.4722734,
230.1723470,
230.8724248,
231.5725068,
232.2725930,
232.9726832,
233.6727775,
234.3728758,
235.0729781,
235.7730843,
236.4731944,
237.1733083,
237.8734260,
238.5735474,
239.2736726,
239.9738015,
240.6739339,
241.3740700,
242.0742097,
242.7743528,
243.4744995,
244.1746495,
244.8748031,
245.5749599,
246.2751202,
246.9752837,
247.6754505,
248.3756206,
249.0757938,
249.7759703,
250.4761499,
251.1763326,
251.8765184,
252.5767072,
253.2768991,
253.9770939,
254.6772918,
255.3774925,
256.0776962,
256.7779028,
257.4781122,
258.1783244,
258.8785394,
259.5787572,
260.2789778,
260.9792011,
261.6794270,
262.3796556,
263.0798869,
263.7801208,
264.4803573,
265.1805964,
265.8808380,
266.5810821,
267.2813288,
267.9815779,
268.6818295,
269.3820835,
270.0823399,
270.7825987,
271.4828599,
272.1831235,
272.8833893,
273.5836575,
274.2839280,
274.9842007,
275.6844757,
276.3847530,
277.0850324,
277.7853140,
278.4855978,
279.1858838,
279.8861718,
280.5864621,
281.2867544,
281.9870488,
282.6873452,
283.3876437,
284.0879443,
284.7882468,
285.4885514,
286.1888579,
286.8891664,
287.5894769,
288.2897892,
288.9901035,
289.6904198,
290.3907379,
291.0910578,
291.7913796,
292.4917033,
293.1920288,
293.8923561,
294.5926853,
295.2930162,
295.9933488,
296.6936833,
297.3940194,
298.0943574,
298.7946970,
299.4950383,
300.1953814,
300.8957261,
301.5960724,
302.2964205,
302.9967701,
303.6971215,
304.3974744,
305.0978289,]



    # import matplotlib.pyplot as plt
    #
    # plt.plot(xs, fx)
    # plt.plot(xs, expected)
    # plt.show()

    assert_allclose(fx, expected, rtol=1e-2) # , atol=1e-2)




